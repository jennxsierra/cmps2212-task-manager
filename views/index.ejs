<!-- Filename: views/index.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Metadata & Stylesheet -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <!-- Main Page Container -->
    <div class="page-container">
      <!-- Application Window -->
      <div class="app-window">
        <!-- Window Title Bar -->
        <div class="window-titlebar">
          <span class="window-title">Task Manager</span>
          <div class="window-controls">
            <button class="window-btn minimize" title="Minimize">_</button>
            <button class="window-btn maximize" title="Maximize">‚òê</button>
            <button class="window-btn close" title="Close">X</button>
          </div>
        </div>
        <!-- Window Content Area -->
        <div class="window-content">
          <!-- Add New Task Section -->
          <section class="task-section">
            <h2>Add New Task</h2>
            <form action="/add-task" method="POST" class="task-form">
              <label for="title">Title:</label>
              <input type="text" name="title" id="title" required />

              <label for="description">Description [optional]:</label>
              <textarea name="description" id="description"></textarea>

              <button type="submit">Add Task</button>
            </form>
          </section>

          <!-- Task List Section -->
          <section class="task-list-section">
            <div class="task-list-header">
              <h2>Task List</h2>
            </div>
            <!-- Search & Filter Forms -->
            <div class="search-filter-container">
              <!-- Filter Form -->
              <form action="/" method="GET" class="filter-form">
                <!-- Preserve the current search query -->
                <input type="hidden" name="q" value="<%= q %>" />
                <div class="filter-buttons">
                  <label>
                    <input type="radio" name="filter" value="all" <%= filter ===
                    'all' ? 'checked' : '' %> /> All
                  </label>
                  <label>
                    <input type="radio" name="filter" value="completed" <%=
                    filter === 'completed' ? 'checked' : '' %> /> Completed
                  </label>
                  <label>
                    <input type="radio" name="filter" value="incomplete" <%=
                    filter === 'incomplete' ? 'checked' : '' %> /> Incomplete
                  </label>
                </div>
                <button type="submit">Filter</button>
              </form>

              <!-- Search Form -->
              <form action="/" method="GET" class="search-form">
                <!-- Preserve the current filter -->
                <input type="hidden" name="filter" value="<%= filter %>" />
                <input
                  type="text"
                  name="q"
                  placeholder="Search tasks..."
                  value="<%= q %>"
                />
                <button type="submit">Search</button>
              </form>
            </div>

            <% if (tasks.length === 0) { %>
            <p>No tasks available.</p>
            <% } else { %>
            <ul class="task-list">
              <% tasks.forEach(task => { %>
              <li class="task-item <%= task.completed ? 'completed' : '' %>">
                <div class="task-details">
                  <strong><%= task.title %></strong>
                  <% if (task.description) { %>
                  <p><%= task.description %></p>
                  <% } %>
                </div>
                <div class="task-actions">
                  <form action="/toggle-task/<%= task.id %>" method="POST">
                    <button type="submit" class="complete-button">
                      <%= task.completed ? 'Reopen' : 'Complete' %>
                    </button>
                  </form>
                  <form action="/delete-task/<%= task.id %>" method="POST">
                    <button type="submit" class="delete-button">Delete</button>
                  </form>
                </div>
              </li>
              <% }); %>
            </ul>
            <% } %>
          </section>
        </div>
      </div>
      <!-- Footer -->
      <footer class="footer">
        <p>&copy; Jennessa Sierra | CMPS2212</p>
      </footer>
    </div>
  </body>
</html>
